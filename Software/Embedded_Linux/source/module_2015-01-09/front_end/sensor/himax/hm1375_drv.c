/**
 * @file hm1375_drv.c
 * HiMax HM1375 1.3MP Image CMOS Sensor Driver
 * Copyright (C) 2013 GM Corp. (http://www.grain-media.com)
 *
 * $Revision: 1.4 $
 * $Date: 2014/07/29 05:36:15 $
 *
 * ChangeLog:
 *  $Log: hm1375_drv.c,v $
 *  Revision 1.4  2014/07/29 05:36:15  shawn_hu
 *  Add the module parameter of "ibus" to specify which I2C bus has the decoder attached.
 *
 *  Revision 1.3  2013/11/11 05:45:43  jerson_l
 *  1. add ch_id module parameter for specify video channel index
 *
 *  Revision 1.2  2013/10/24 10:05:43  jerson_l
 *  1. change pixel clock to rising edge trigger
 *
 *  Revision 1.1.1.1  2013/10/24 02:51:52  jerson_l
 *  add sensor driver
 *
 */

#include <linux/version.h>
#include <linux/types.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/string.h>
#include <linux/proc_fs.h>
#include <linux/kthread.h>
#include <linux/miscdevice.h>
#include <linux/i2c.h>
#include <linux/seq_file.h>
#include <linux/delay.h>
#include <asm/uaccess.h>

#include "platform.h"
#include "himax/hm1375.h"                   ///< from module/include/front_end/sensor

#define HM1375_CLKIN_27MHZ                  27000000
#define HM1375_CLKIN_54MHZ                  54000000

/* device number */
static int dev_num = 1;
module_param(dev_num, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(dev_num, "Device Number: 1");

/* device i2c bus */
static int ibus = 0;
module_param(ibus, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(ibus, "Device I2C Bus: 0~4");

/* device i2c address */
static ushort iaddr[HM1375_DEV_MAX] = {0x48};
module_param_array(iaddr, ushort, NULL, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(iaddr, "Device I2C Address");

/* clock port used */
static int clk_used = 0x1;
module_param(clk_used, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(clk_used, "External Clock Port: BIT0:EXT_CLK0, BIT1:EXT_CLK1");

/* clock source */
static int clk_src = PLAT_EXTCLK_SRC_PLL3;
module_param(clk_src, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(clk_src, "External Clock Source: 0:PLL1OUT1 1:PLL1OUT1/2 2:PLL4OUT2 3:PLL4OUT1/2 4:PLL3");

/* clock frequency */
static int clk_freq = HM1375_CLKIN_27MHZ;
module_param(clk_freq, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(clk_freq, "External Clock Frequency(Hz)");

/* device video mode */
static int vmode[HM1375_DEV_MAX] = {[0 ... (HM1375_DEV_MAX - 1)] = HM1375_VMODE_HD720};
module_param_array(vmode, int, NULL, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(vmode, "Video Mode: 0:VGA 1:HD720 2:WXGA_960 3:SXGA");

/* device init */
static int init = 1;
module_param(init, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(init, "device init: 0:no-init  1:init");

/* device use gpio as rstb pin */
static int rstb_used = PLAT_GPIO_ID_X_CAP_RST;
module_param(rstb_used, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(rstb_used, "Use GPIO as RSTB Pin: 0:None, 1:X_CAP_RST");

static int is_50hz = 0;
module_param(is_50hz, int, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(is_50hz, "is_50hz: 0:60Hz 1:50Hz");

/* device video channel index */
static int ch_id[HM1375_DEV_MAX]= {0};
module_param_array(ch_id, int, NULL, S_IRUGO | S_IWUSR);
MODULE_PARM_DESC(ch_id, "Video Channel Index");

struct hm1375_dev_t {
    int                     index;                          ///< device index
    char                    name[16];                       ///< device name
    struct semaphore        lock;                           ///< device locker
    struct miscdevice       miscdev;                        ///< device node for ioctl access
    HM1375_VMODE_T          vmode;                          ///< device current video output mode
};

static struct i2c_client     *hm1375_i2c_client = NULL;
static struct hm1375_dev_t    hm1375_dev[HM1375_DEV_MAX];
static struct proc_dir_entry *hm1375_proc_root[HM1375_DEV_MAX]  = {[0 ... (HM1375_DEV_MAX - 1)] = NULL};
static struct proc_dir_entry *hm1375_proc_vmode[HM1375_DEV_MAX] = {[0 ... (HM1375_DEV_MAX - 1)] = NULL};

static u16 HM1375_VGA_CFG[] = {
    0x0022, 0x00,
    0x000C, 0x04,
    0x0006, 0x0C,
    0x000A, 0x20,
    0x000F, 0x10,
    0x0012, 0x01,
    0x0013, 0x02,
    0x0015, 0x01,
    0x0016, 0x00,
    0x0018, 0x00,
    0x001D, 0x40,
    0x0020, 0x30,
    0x0023, 0x43,
    0x0024, 0x20,
    0x0025, 0x00,
    0x0026, 0x0F,
    0x0027, 0x90,   ///< CbYCrY, ITU-BT601 Enable
    0x0028, 0x01,
    0x0029, 0x80,   ///< CCIR656 Enable
    0x002B, 0x81,
    0x002E, 0x0E,
    0x0030, 0x00,
    0x0034, 0x0E,
    0x0035, 0x01,
    0x0036, 0x00,
    0x0038, 0x02,
    0x0039, 0x01,
    0x003A, 0x01,
    0x003B, 0xFF,
    0x003C, 0xFF,
    0x003D, 0x40,
    0x003F, 0x14,
    0x0040, 0x10,
    0x0044, 0x07,
    0x0045, 0x25,
    0x0048, 0x7F,
    0x004E, 0xFF,
    0x0070, 0x00,
    0x0071, 0x4F,
    0x0072, 0x00,
    0x0073, 0x30,
    0x0074, 0x13,
    0x0075, 0x40,
    0x0076, 0x24,
    0x0078, 0x0F,
    0x007A, 0x05,
    0x007B, 0xF2,
    0x007C, 0x10,
    0x0080, 0xC9,
    0x0081, 0x00,
    0x0082, 0x28,
    0x0083, 0xB0,
    0x0084, 0x70,
    0x0086, 0x3E,
    0x0087, 0x70,
    0x0088, 0x11,
    0x0089, 0x3C,
    0x008A, 0x87,
    0x008D, 0x64,
    0x0090, 0x07,
    0x0091, 0x09,
    0x0092, 0x0C,
    0x0093, 0x0C,
    0x0094, 0x0C,
    0x0095, 0x0C,
    0x0096, 0x01,
    0x0097, 0x00,
    0x0098, 0x04,
    0x0099, 0x08,
    0x009A, 0x0C,
    0x0120, 0x37,
    0x0121, 0x81,
    0x0122, 0xEB,
    0x0123, 0x29,
    0x0124, 0x50,
    0x0125, 0xDE,
    0x0126, 0xB1,
    0x013D, 0x0F,
    0x013E, 0x0F,
    0x013F, 0x0F,
    0x0140, 0x14,
    0x0141, 0x0A,
    0x0142, 0x14,
    0x0143, 0x0A,
    0x0144, 0x08,
    0x0145, 0x04,
    0x0146, 0x28,
    0x0147, 0x3C,
    0x0148, 0x28,
    0x0149, 0x3C,
    0x014A, 0x96,
    0x014B, 0xC8,
    0x0150, 0x14,
    0x0151, 0x30,
    0x0152, 0x54,
    0x0153, 0x70,
    0x0154, 0x14,
    0x0155, 0x30,
    0x0156, 0x54,
    0x0157, 0x70,
    0x0158, 0x14,
    0x0159, 0x30,
    0x015A, 0x54,
    0x015B, 0x70,
    0x015C, 0x30,
    0x015D, 0x00,
    0x01D8, 0x20,
    0x01D9, 0x08,
    0x01DA, 0x20,
    0x01DB, 0x08,
    0x01DC, 0x20,
    0x01DD, 0x08,
    0x01DE, 0x20,
    0x01DF, 0x08,
    0x01E0, 0x20,
    0x01E1, 0x08,
    0x01E2, 0xFF,
    0x01E3, 0x00,
    0x01E4, 0x10,
    0x01E5, 0x10,
    0x01E6, 0x02,
    0x01E7, 0x10,
    0x01E8, 0x10,
    0x01E9, 0x10,
    0x01EA, 0x10,
    0x01EC, 0xFA,
    0x01EB, 0x10,
    0x0220, 0xF0,
    0x0221, 0xA0,
    0x0222, 0x00,
    0x0223, 0x80,
    0x0224, 0x80,
    0x0225, 0x00,
    0x0226, 0x80,
    0x0227, 0x80,
    0x0228, 0x00,
    0x0229, 0x80,
    0x022A, 0x80,
    0x022B, 0x00,
    0x022C, 0x80,
    0x022D, 0x12,
    0x022E, 0x10,
    0x022F, 0x12,
    0x0230, 0x10,
    0x0231, 0x12,
    0x0232, 0x10,
    0x0233, 0x12,
    0x0234, 0x10,
    0x0235, 0x80,
    0x0236, 0x02,
    0x0237, 0x80,
    0x0238, 0x02,
    0x0239, 0x80,
    0x023A, 0x02,
    0x023B, 0x80,
    0x023C, 0x02,
    0x023D, 0x00,
    0x023E, 0x02,
    0x023F, 0x00,
    0x0240, 0x02,
    0x0241, 0x00,
    0x0242, 0x02,
    0x0243, 0x00,
    0x0244, 0x02,
    0x0251, 0x10,
    0x0280, 0x00,
    0x0281, 0x41,
    0x0282, 0x00,
    0x0283, 0x6D,
    0x0284, 0x00,
    0x0285, 0xBC,
    0x0286, 0x01,
    0x0287, 0x45,
    0x0288, 0x01,
    0x0289, 0x7B,
    0x028A, 0x01,
    0x028B, 0xAC,
    0x028C, 0x01,
    0x028D, 0xD2,
    0x028E, 0x01,
    0x028F, 0xF6,
    0x0290, 0x02,
    0x0291, 0x16,
    0x0292, 0x02,
    0x0293, 0x35,
    0x0294, 0x02,
    0x0295, 0x6E,
    0x0296, 0x02,
    0x0297, 0xA2,
    0x0298, 0x02,
    0x0299, 0xFF,
    0x029A, 0x03,
    0x029B, 0x51,
    0x029C, 0x03,
    0x029D, 0x9B,
    0x029E, 0x00,
    0x029F, 0x85,
    0x02A0, 0x04,
    0x02C0, 0x80,
    0x02C1, 0x01,
    0x02C2, 0x71,
    0x02C3, 0x04,
    0x02C4, 0x0F,
    0x02C5, 0x04,
    0x02C6, 0x3D,
    0x02C7, 0x04,
    0x02C8, 0x94,
    0x02C9, 0x01,
    0x02CA, 0x57,
    0x02CB, 0x04,
    0x02CC, 0x0F,
    0x02CD, 0x04,
    0x02CE, 0x8F,
    0x02CF, 0x04,
    0x02D0, 0x9E,
    0x02D1, 0x01,
    0x02E0, 0x06,
    0x02E1, 0xC0,
    0x02E2, 0xE0,
    0x02F0, 0x48,
    0x02F1, 0x01,
    0x02F2, 0x32,
    0x02F3, 0x04,
    0x02F4, 0x16,
    0x02F5, 0x04,
    0x02F6, 0x52,
    0x02F7, 0x04,
    0x02F8, 0xAA,
    0x02F9, 0x01,
    0x02FA, 0x58,
    0x02FB, 0x04,
    0x02FC, 0x56,
    0x02FD, 0x04,
    0x02FE, 0xDD,
    0x02FF, 0x04,
    0x0300, 0x33,
    0x0301, 0x02,
    0x0324, 0x00,
    0x0325, 0x01,
    0x0333, 0x86,
    0x0334, 0x00,
    0x0335, 0x86,
    0x0340, 0x40,
    0x0341, 0x44,
    0x0342, 0x4A,
    0x0343, 0x2B,
    0x0344, 0x94,
    0x0345, 0x3F,
    0x0346, 0x8E,
    0x0347, 0x51,
    0x0348, 0x75,
    0x0349, 0x5C,
    0x034A, 0x6A,
    0x034B, 0x68,
    0x034C, 0x5E,
    0x0350, 0x7C,
    0x0351, 0x78,
    0x0352, 0x08,
    0x0353, 0x04,
    0x0354, 0x80,
    0x0355, 0x9A,
    0x0356, 0xCC,
    0x0357, 0xFF,
    0x0358, 0xFF,
    0x035A, 0xFF,
    0x035B, 0x00,
    0x035C, 0x70,
    0x035D, 0x80,
    0x035F, 0xA0,
    0x0488, 0x30,
    0x0360, 0xDF,
    0x0361, 0x00,
    0x0362, 0xFF,
    0x0363, 0x03,
    0x0364, 0xFF,
    0x037B, 0x11,
    0x037C, 0x1E,
    0x0380, 0xFF,
    0x0383, 0x50,
    0x038A, 0x64,
    0x038B, 0x64,
    0x038E, 0x3C,
    0x0391, 0x2A,
    0x0393, 0x1E,
    0x0394, 0x64,
    0x0395, 0x23,
    0x0398, 0x03,
    0x0399, 0x45,
    0x039A, 0x06,
    0x039B, 0x8B,
    0x039C, 0x0D,
    0x039D, 0x16,
    0x039E, 0x0A,
    0x039F, 0x10,
    0x03A0, 0x10,
    0x03A1, 0xE5,
    0x03A2, 0x06,
    0x03A4, 0x18,
    0x03A5, 0x48,
    0x03A6, 0x2D,
    0x03A7, 0x78,
    0x03AC, 0x5A,
    0x03AD, 0x0F,
    0x03AE, 0x7F,
    0x03AF, 0x04,
    0x03B0, 0x35,
    0x03B1, 0x14,
    0x036F, 0x04,
    0x0370, 0x0A,
    0x0371, 0x04,
    0x0372, 0x10,
    0x0373, 0x40,
    0x0374, 0x20,
    0x0375, 0x04,
    0x0376, 0x00,
    0x0377, 0x08,
    0x0378, 0x08,
    0x0379, 0x04,
    0x037A, 0x08,
    0x0420, 0x00,
    0x0421, 0x00,
    0x0422, 0x00,
    0x0423, 0x84,
    0x0430, 0x10,
    0x0431, 0x60,
    0x0432, 0x10,
    0x0433, 0x20,
    0x0434, 0x00,
    0x0435, 0x30,
    0x0436, 0x00,
    0x0450, 0xFD,
    0x0451, 0xD8,
    0x0452, 0xA0,
    0x0453, 0x50,
    0x0454, 0x00,
    0x0459, 0x04,
    0x045A, 0x00,
    0x045B, 0x30,
    0x045C, 0x01,
    0x045D, 0x70,
    0x0460, 0x00,
    0x0461, 0x00,
    0x0462, 0x00,
    0x0465, 0x16,
    0x0466, 0x14,
    0x0478, 0x00,
    0x0480, 0x60,
    0x0481, 0x06,
    0x0482, 0x0C,
    0x04B0, 0x4C,
    0x04B1, 0x86,
    0x04B2, 0x00,
    0x04B3, 0x18,
    0x04B4, 0x00,
    0x04B5, 0x00,
    0x04B6, 0x30,
    0x04B7, 0x00,
    0x04B8, 0x00,
    0x04B9, 0x10,
    0x04BA, 0x00,
    0x04BB, 0x00,
    0x04BD, 0x00,
    0x04D0, 0x56,
    0x04D6, 0x30,
    0x04DD, 0x10,
    0x04D9, 0x16,
    0x04D3, 0x18,
    0x0540, 0x01,
    0x0541, 0x06,
    0x0542, 0x01,
    0x0543, 0x3B,
    0x0580, 0x50,
    0x0581, 0x30,
    0x0582, 0x2D,
    0x0583, 0x16,
    0x0584, 0x1E,
    0x0585, 0x0F,
    0x0586, 0x08,
    0x0587, 0x10,
    0x0590, 0x10,
    0x0591, 0x10,
    0x0592, 0x05,
    0x0593, 0x05,
    0x0594, 0x04,
    0x0595, 0x06,
    0x05B0, 0x04,
    0x05B1, 0x00,
    0x05E4, 0x02,
    0x05E5, 0x00,
    0x05E6, 0x81,
    0x05E7, 0x02,
    0x05E8, 0x00,
    0x05E9, 0x00,
    0x05EA, 0xEB,
    0x05EB, 0x01,
    0x0666, 0x02,
    0x0667, 0xE0,
    0x067F, 0x19,
    0x067C, 0x00,
    0x067D, 0x00,
    0x0682, 0x00,
    0x0683, 0x00,
    0x0688, 0x00,
    0x0689, 0x00,
    0x068E, 0x00,
    0x068F, 0x00,
    0x0695, 0x00,
    0x0694, 0x00,
    0x0697, 0x19,
    0x069B, 0x00,
    0x069C, 0x20,
    0x0720, 0x00,
    0x0725, 0x6A,
    0x0726, 0x03,
    0x072B, 0x64,
    0x072C, 0x64,
    0x072D, 0x20,
    0x072E, 0x82,
    0x072F, 0x08,
    0x0800, 0x16,
    0x0801, 0x4F,
    0x0802, 0x00,
    0x0803, 0x68,
    0x0804, 0x01,
    0x0805, 0x28,
    0x0806, 0x10,
    0x0808, 0x1D,
    0x0809, 0x18,
    0x080A, 0x10,
    0x080B, 0x07,
    0x080D, 0x0F,
    0x080E, 0x0F,
    0x0810, 0x00,
    0x0811, 0x08,
    0x0812, 0x20,
    0x0857, 0x0A,
    0x0858, 0x04,
    0x0859, 0x01,
    0x085A, 0x04,
    0x085B, 0x18,
    0x085C, 0x03,
    0x085D, 0x7F,
    0x085E, 0x02,
    0x085F, 0xD0,
    0x0860, 0x03,
    0x0861, 0x7F,
    0x0862, 0x02,
    0x0863, 0xD0,
    0x0864, 0x02,
    0x0865, 0x7F,
    0x0866, 0x01,
    0x0867, 0x00,
    0x0868, 0x40,
    0x0869, 0x01,
    0x086A, 0x00,
    0x086B, 0x40,
    0x086C, 0x01,
    0x086D, 0x00,
    0x086E, 0x40,
    0x0870, 0x00,
    0x0871, 0x14,
    0x0872, 0x01,
    0x0873, 0x20,
    0x0874, 0x00,
    0x0875, 0x14,
    0x0876, 0x00,
    0x0877, 0xEC,
    0x0815, 0x00,
    0x0816, 0x4C,
    0x0817, 0x00,
    0x0818, 0x7B,
    0x0819, 0x00,
    0x081A, 0xCA,
    0x081B, 0x01,
    0x081C, 0x3E,
    0x081D, 0x01,
    0x081E, 0x77,
    0x081F, 0x01,
    0x0820, 0xAA,
    0x0821, 0x01,
    0x0822, 0xCE,
    0x0823, 0x01,
    0x0824, 0xEE,
    0x0825, 0x02,
    0x0826, 0x16,
    0x0827, 0x02,
    0x0828, 0x33,
    0x0829, 0x02,
    0x082A, 0x65,
    0x082B, 0x02,
    0x082C, 0x91,
    0x082D, 0x02,
    0x082E, 0xDC,
    0x082F, 0x03,
    0x0830, 0x28,
    0x0831, 0x03,
    0x0832, 0x74,
    0x0833, 0x03,
    0x0834, 0xFF,
    0x0882, 0x00,
    0x0883, 0x3E,
    0x0884, 0x00,
    0x0885, 0x70,
    0x0886, 0x00,
    0x0887, 0xB8,
    0x0888, 0x01,
    0x0889, 0x28,
    0x088A, 0x01,
    0x088B, 0x5B,
    0x088C, 0x01,
    0x088D, 0x8A,
    0x088E, 0x01,
    0x088F, 0xB1,
    0x0890, 0x01,
    0x0891, 0xD9,
    0x0892, 0x01,
    0x0893, 0xEE,
    0x0894, 0x02,
    0x0895, 0x0F,
    0x0896, 0x02,
    0x0897, 0x4C,
    0x0898, 0x02,
    0x0899, 0x74,
    0x089A, 0x02,
    0x089B, 0xC3,
    0x089C, 0x03,
    0x089D, 0x0F,
    0x089E, 0x03,
    0x089F, 0x57,
    0x08A0, 0x03,
    0x08A1, 0xFF,
    0x0100, 0x01,
    0x0101, 0x01,
    0x0000, 0x01,
    0x002C, 0x00,
    0x0005, 0x01,
};

static u16 HM1375_HD720_CFG[] = {
    0x0022, 0x00,
    0x000C, 0x04,
    0x0006, 0x08,
    0x000A, 0x00,
    0x000F, 0x10,
    0x0010, 0x00,
    0x0011, 0x10,
    0x0012, 0x01,
    0x0013, 0x02,
    0x0015, 0x01,
    0x0016, 0x00,
    0x0018, 0x00,
    0x001D, 0x40,
    0x0020, 0x30,
    0x0023, 0x43,
    0x0024, 0x20,
    0x0025, 0x01,
    0x0026, 0x51,
    0x0027, 0x90,   ///< CbYCrY, ITU-BT601 Enable
    0x0028, 0x01,
    0x0029, 0x80,   ///< CCIR656 Enable
    0x0030, 0x00,
    0x0034, 0x0E,
    0x0035, 0x01,
    0x0036, 0x00,
    0x0038, 0x02,
    0x0039, 0x01,
    0x003A, 0x01,
    0x003B, 0xFF,
    0x003C, 0xFF,
    0x003D, 0x40,
    0x003F, 0x14,
    0x0040, 0x10,
    0x0044, 0x07,
    0x0045, 0x31,
    0x0048, 0x7F,
    0x004E, 0xFF,
    0x0070, 0x22,
    0x0071, 0x3F,
    0x0072, 0x22,
    0x0073, 0x30,
    0x0074, 0x13,
    0x0075, 0x40,
    0x0076, 0x24,
    0x0078, 0x0F,
    0x007A, 0x06,
    0x007B, 0x21,
    0x007C, 0x10,
    0x0080, 0xC9,
    0x0081, 0x00,
    0x0082, 0x28,
    0x0083, 0xB0,
    0x0084, 0x60,
    0x0086, 0x3E,
    0x0087, 0x70,
    0x0088, 0x11,
    0x0089, 0x3C,
    0x008A, 0x87,
    0x008D, 0x64,
    0x0090, 0x07,
    0x0091, 0x09,
    0x0092, 0x0C,
    0x0093, 0x0C,
    0x0094, 0x0C,
    0x0095, 0x0C,
    0x0096, 0x01,
    0x0097, 0x00,
    0x0098, 0x04,
    0x0099, 0x08,
    0x009A, 0x0C,
    0x0120, 0x37,
    0x0121, 0x81,
    0x0122, 0xEB,
    0x0123, 0x29,
    0x0124, 0x50,
    0x0125, 0xDE,
    0x0126, 0xB1,
    0x013D, 0x0F,
    0x013E, 0x0F,
    0x013F, 0x0F,
    0x0140, 0x14,
    0x0141, 0x0A,
    0x0142, 0x14,
    0x0143, 0x0A,
    0x0144, 0x08,
    0x0145, 0x04,
    0x0146, 0x28,
    0x0147, 0x3C,
    0x0148, 0x28,
    0x0149, 0x3C,
    0x014A, 0x96,
    0x014B, 0xC8,
    0x0150, 0x14,
    0x0151, 0x30,
    0x0152, 0x54,
    0x0153, 0x70,
    0x0154, 0x14,
    0x0155, 0x30,
    0x0156, 0x54,
    0x0157, 0x70,
    0x0158, 0x14,
    0x0159, 0x30,
    0x015A, 0x54,
    0x015B, 0x70,
    0x015C, 0x30,
    0x015D, 0x00,
    0x01D8, 0x20,
    0x01D9, 0x08,
    0x01DA, 0x20,
    0x01DB, 0x08,
    0x01DC, 0x20,
    0x01DD, 0x08,
    0x01DE, 0x50,
    0x01E0, 0x50,
    0x01E2, 0x50,
    0x01E4, 0x10,
    0x01E5, 0x10,
    0x01E6, 0x02,
    0x01E7, 0x10,
    0x01E8, 0x10,
    0x01E9, 0x10,
    0x01EC, 0x28,
    0x0220, 0x00,
    0x0221, 0xA0,
    0x0222, 0x00,
    0x0223, 0x80,
    0x0224, 0x80,
    0x0225, 0x00,
    0x0226, 0x80,
    0x0227, 0x80,
    0x0228, 0x00,
    0x0229, 0x80,
    0x022A, 0x80,
    0x022B, 0x00,
    0x022C, 0x80,
    0x022D, 0x12,
    0x022E, 0x10,
    0x022F, 0x12,
    0x0230, 0x10,
    0x0231, 0x12,
    0x0232, 0x10,
    0x0233, 0x12,
    0x0234, 0x10,
    0x0235, 0x88,
    0x0236, 0x02,
    0x0237, 0x88,
    0x0238, 0x02,
    0x0239, 0x88,
    0x023A, 0x02,
    0x023B, 0x88,
    0x023C, 0x02,
    0x023D, 0x04,
    0x023E, 0x02,
    0x023F, 0x04,
    0x0240, 0x02,
    0x0241, 0x04,
    0x0242, 0x02,
    0x0243, 0x04,
    0x0244, 0x02,
    0x0251, 0x10,
    0x0280, 0x00,
    0x0281, 0x41,
    0x0282, 0x00,
    0x0283, 0x6D,
    0x0284, 0x00,
    0x0285, 0xBC,
    0x0286, 0x01,
    0x0287, 0x45,
    0x0288, 0x01,
    0x0289, 0x7B,
    0x028A, 0x01,
    0x028B, 0xAC,
    0x028C, 0x01,
    0x028D, 0xD2,
    0x028E, 0x01,
    0x028F, 0xF6,
    0x0290, 0x02,
    0x0291, 0x16,
    0x0292, 0x02,
    0x0293, 0x35,
    0x0294, 0x02,
    0x0295, 0x6E,
    0x0296, 0x02,
    0x0297, 0xA2,
    0x0298, 0x02,
    0x0299, 0xFF,
    0x029A, 0x03,
    0x029B, 0x51,
    0x029C, 0x03,
    0x029D, 0x9B,
    0x029E, 0x00,
    0x029F, 0x85,
    0x02A0, 0x04,
    0x02C0, 0x80,
    0x02C1, 0x01,
    0x02C2, 0x71,
    0x02C3, 0x04,
    0x02C4, 0x0F,
    0x02C5, 0x04,
    0x02C6, 0x3D,
    0x02C7, 0x04,
    0x02C8, 0x94,
    0x02C9, 0x01,
    0x02CA, 0x57,
    0x02CB, 0x04,
    0x02CC, 0x0F,
    0x02CD, 0x04,
    0x02CE, 0x8F,
    0x02CF, 0x04,
    0x02D0, 0x9E,
    0x02D1, 0x01,
    0x02E0, 0x06,
    0x02E1, 0xC0,
    0x02E2, 0xE0,
    0x02F0, 0x48,
    0x02F1, 0x01,
    0x02F2, 0x32,
    0x02F3, 0x04,
    0x02F4, 0x16,
    0x02F5, 0x04,
    0x02F6, 0x52,
    0x02F7, 0x04,
    0x02F8, 0xAA,
    0x02F9, 0x01,
    0x02FA, 0x58,
    0x02FB, 0x04,
    0x02FC, 0x56,
    0x02FD, 0x04,
    0x02FE, 0xDD,
    0x02FF, 0x04,
    0x0300, 0x33,
    0x0301, 0x02,
    0x0324, 0x00,
    0x0325, 0x01,
    0x0333, 0x86,
    0x0334, 0x00,
    0x0335, 0x86,
    0x0340, 0x40,
    0x0341, 0x44,
    0x0342, 0x4A,
    0x0343, 0x2B,
    0x0344, 0x94,
    0x0345, 0x3F,
    0x0346, 0x8E,
    0x0347, 0x51,
    0x0348, 0x75,
    0x0349, 0x60,
    0x034A, 0x60,
    0x034B, 0x68,
    0x034C, 0x5E,
    0x0350, 0x7C,
    0x0351, 0x78,
    0x0352, 0x08,
    0x0353, 0x04,
    0x0354, 0x80,
    0x0355, 0x9A,
    0x0356, 0xCC,
    0x0357, 0xFF,
    0x0358, 0xFF,
    0x035A, 0xFF,
    0x035B, 0x00,
    0x035C, 0x70,
    0x035D, 0x80,
    0x035F, 0xA0,
    0x0488, 0x30,
    0x0360, 0xDF,
    0x0361, 0x00,
    0x0362, 0xFF,
    0x0363, 0x03,
    0x0364, 0xFF,
    0x037B, 0x11,
    0x037C, 0x1E,
    0x0380, 0xFF,
    0x0383, 0x50,
    0x038A, 0x64,
    0x038B, 0x64,
    0x038E, 0x3C,
    0x0391, 0x2A,
    0x0393, 0x1E,
    0x0394, 0x64,
    0x0395, 0x23,
    0x0398, 0x04,
    0x0399, 0x08,
    0x039A, 0x06,
    0x039B, 0x0c,
    0x039C, 0x0a,
    0x039D, 0x14,
    0x039E, 0x0A,
    0x039F, 0x10,
    0x03A0, 0x10,
    0x03A1, 0xE5,
    0x03A2, 0x06,
    0x03A4, 0x18,
    0x03A5, 0x48,
    0x03A6, 0x2D,
    0x03A7, 0x78,
    0x03AC, 0x5A,
    0x03AD, 0x0F,
    0x03AE, 0x7F,
    0x03AF, 0x04,
    0x03B0, 0x35,
    0x03B1, 0x14,
    0x036F, 0x04,
    0x0370, 0x0A,
    0x0371, 0x04,
    0x0372, 0x00,
    0x0373, 0x40,
    0x0374, 0x20,
    0x0375, 0x04,
    0x0376, 0x00,
    0x0377, 0x08,
    0x0378, 0x08,
    0x0379, 0x04,
    0x037A, 0x08,
    0x0420, 0x00,
    0x0421, 0x00,
    0x0422, 0x00,
    0x0423, 0x84,
    0x0430, 0x10,
    0x0431, 0x60,
    0x0432, 0x10,
    0x0433, 0x20,
    0x0434, 0x00,
    0x0435, 0x30,
    0x0436, 0x00,
    0x0450, 0xFD,
    0x0451, 0xD8,
    0x0452, 0xA0,
    0x0453, 0x50,
    0x0459, 0x04,
    0x045A, 0x00,
    0x045B, 0x30,
    0x045C, 0x01,
    0x045D, 0x70,
    0x0460, 0x00,
    0x0461, 0x00,
    0x0462, 0x00,
    0x0465, 0x86,
    0x0466, 0x84,
    0x0478, 0x00,
    0x0480, 0x50,
    0x0481, 0x06,
    0x0482, 0x0C,
    0x04B0, 0x4C,
    0x04B1, 0x86,
    0x04B2, 0x00,
    0x04B3, 0x18,
    0x04B4, 0x00,
    0x04B5, 0x00,
    0x04B6, 0x30,
    0x04B7, 0x00,
    0x04B8, 0x00,
    0x04B9, 0x10,
    0x04BA, 0x00,
    0x04BB, 0x00,
    0x04BD, 0x00,
    0x04D0, 0x56,
    0x04D6, 0x30,
    0x04DD, 0x10,
    0x04D9, 0x16,
    0x04D3, 0x18,
    0x0540, 0x00,
    0x0541, 0xd7,
    0x0542, 0x01,
    0x0543, 0x02,
    0x0580, 0x43,
    0x0581, 0x30,
    0x0582, 0x2D,
    0x0583, 0x16,
    0x0584, 0x1E,
    0x0585, 0x0F,
    0x0586, 0x08,
    0x0587, 0x10,
    0x0590, 0x10,
    0x0591, 0x10,
    0x0592, 0x05,
    0x0593, 0x05,
    0x0594, 0x04,
    0x0595, 0x06,
    0x05B0, 0x04,
    0x05B1, 0x00,
    0x05E4, 0x08,
    0x05E5, 0x00,
    0x05E6, 0x07,
    0x05E7, 0x05,
    0x05E8, 0x0A,
    0x05E9, 0x00,
    0x05EA, 0xDB,
    0x05EB, 0x02,
    0x0666, 0x02,
    0x0667, 0xE0,
    0x067F, 0x19,
    0x067C, 0x00,
    0x067D, 0x00,
    0x0682, 0x00,
    0x0683, 0x00,
    0x0688, 0x00,
    0x0689, 0x00,
    0x068E, 0x00,
    0x068F, 0x00,
    0x0695, 0x00,
    0x0694, 0x00,
    0x0697, 0x19,
    0x069B, 0x00,
    0x069C, 0x20,
    0x0720, 0x00,
    0x0725, 0x6A,
    0x0726, 0x03,
    0x072B, 0x64,
    0x072C, 0x64,
    0x072D, 0x20,
    0x072E, 0x82,
    0x072F, 0x08,
    0x0800, 0x16,
    0x0801, 0x4F,
    0x0802, 0x00,
    0x0803, 0x68,
    0x0804, 0x01,
    0x0805, 0x28,
    0x0806, 0x10,
    0x0808, 0x1D,
    0x0809, 0x18,
    0x080A, 0x10,
    0x080B, 0x07,
    0x080D, 0x0F,
    0x080E, 0x0F,
    0x0810, 0x00,
    0x0811, 0x08,
    0x0812, 0x20,
    0x0857, 0x0A,
    0x0858, 0x04,
    0x0859, 0x01,
    0x085A, 0x03,
    0x085B, 0x5c,
    0x085C, 0x02,
    0x085D, 0x7F,
    0x085E, 0x0a,
    0x085F, 0x14,
    0x0860, 0x03,
    0x0861, 0x7F,
    0x0862, 0x0a,
    0x0863, 0x14,
    0x0864, 0x02,
    0x0865, 0x7F,
    0x0866, 0x01,
    0x0867, 0x00,
    0x0868, 0x40,
    0x0869, 0x01,
    0x086A, 0x00,
    0x086B, 0x40,
    0x086C, 0x01,
    0x086D, 0x00,
    0x086E, 0x40,
    0x0870, 0x00,
    0x0871, 0x14,
    0x0872, 0x01,
    0x0873, 0x20,
    0x0874, 0x00,
    0x0875, 0x14,
    0x0876, 0x00,
    0x0877, 0xEC,
    0x0815, 0x00,
    0x0816, 0x4C,
    0x0817, 0x00,
    0x0818, 0x7B,
    0x0819, 0x00,
    0x081A, 0xCA,
    0x081B, 0x01,
    0x081C, 0x3E,
    0x081D, 0x01,
    0x081E, 0x77,
    0x081F, 0x01,
    0x0820, 0xAA,
    0x0821, 0x01,
    0x0822, 0xCE,
    0x0823, 0x01,
    0x0824, 0xEE,
    0x0825, 0x02,
    0x0826, 0x16,
    0x0827, 0x02,
    0x0828, 0x33,
    0x0829, 0x02,
    0x082A, 0x65,
    0x082B, 0x02,
    0x082C, 0x91,
    0x082D, 0x02,
    0x082E, 0xDC,
    0x082F, 0x03,
    0x0830, 0x28,
    0x0831, 0x03,
    0x0832, 0x74,
    0x0833, 0x03,
    0x0834, 0xFF,
    0x0882, 0x00,
    0x0883, 0x3E,
    0x0884, 0x00,
    0x0885, 0x70,
    0x0886, 0x00,
    0x0887, 0xB8,
    0x0888, 0x01,
    0x0889, 0x28,
    0x088A, 0x01,
    0x088B, 0x5B,
    0x088C, 0x01,
    0x088D, 0x8A,
    0x088E, 0x01,
    0x088F, 0xB1,
    0x0890, 0x01,
    0x0891, 0xD9,
    0x0892, 0x01,
    0x0893, 0xEE,
    0x0894, 0x02,
    0x0895, 0x0F,
    0x0896, 0x02,
    0x0897, 0x4C,
    0x0898, 0x02,
    0x0899, 0x74,
    0x089A, 0x02,
    0x089B, 0xC3,
    0x089C, 0x03,
    0x089D, 0x0F,
    0x089E, 0x03,
    0x089F, 0x57,
    0x08A0, 0x03,
    0x08A1, 0xFF,
    0x0100, 0x01,
    0x0101, 0x01,
    0x0000, 0x01,
    0x002C, 0x00,
    0x0005, 0x01,
};

static u16 HM1375_WXGA_960_CFG[] = {
    0x0022, 0x00,
    0x000C, 0x04,
    0x0006, 0x0C,
    0x000A, 0x00,
    0x000F, 0x10,
    0x0010, 0x00,
    0x0011, 0x02,
    0x0012, 0x01,
    0x0013, 0x02,
    0x0015, 0x01,
    0x0016, 0x00,
    0x0018, 0x00,
    0x001D, 0x40,
    0x0020, 0x30,
    0x0023, 0x43,
    0x0024, 0x20,
    0x0025, 0x00,
    0x0026, 0x6d,
    0x0027, 0x90,   ///< CbYCrY, ITU-BT601 Disable
    0x0028, 0x01,
    0x0029, 0x80,   ///< CCIR656 Enable
    0x0030, 0x00,
    0x0034, 0x0E,
    0x0035, 0x01,
    0x0036, 0x00,
    0x0038, 0x02,
    0x0039, 0x01,
    0x003A, 0x01,
    0x003B, 0xFF,
    0x003C, 0xFF,
    0x003D, 0x40,
    0x003F, 0x14,
    0x0040, 0x10,
    0x0044, 0x07,
    0x0045, 0x25,
    0x0048, 0x7F,
    0x004E, 0xFF,
    0x0070, 0x00,
    0x0071, 0x4F,
    0x0072, 0x00,
    0x0073, 0x30,
    0x0074, 0x13,
    0x0075, 0x40,
    0x0076, 0x24,
    0x0078, 0x0F,
    0x007A, 0x05,
    0x007B, 0xf2,
    0x007C, 0x10,
    0x0080, 0xC9,
    0x0081, 0x00,
    0x0082, 0x28,
    0x0083, 0xB0,
    0x0084, 0x60,
    0x0086, 0x3E,
    0x0087, 0x70,
    0x0088, 0x11,
    0x0089, 0x3C,
    0x008A, 0x87,
    0x008D, 0x64,
    0x0090, 0x07,
    0x0091, 0x09,
    0x0092, 0x0C,
    0x0093, 0x0C,
    0x0094, 0x0C,
    0x0095, 0x0C,
    0x0096, 0x01,
    0x0097, 0x00,
    0x0098, 0x04,
    0x0099, 0x08,
    0x009A, 0x0C,
    0x0120, 0x37,
    0x0121, 0x81,
    0x0122, 0xEB,
    0x0123, 0x29,
    0x0124, 0x50,
    0x0125, 0xDE,
    0x0126, 0xB1,
    0x013D, 0x0F,
    0x013E, 0x0F,
    0x013F, 0x0F,
    0x0140, 0x14,
    0x0141, 0x0A,
    0x0142, 0x14,
    0x0143, 0x0A,
    0x0144, 0x08,
    0x0145, 0x04,
    0x0146, 0x28,
    0x0147, 0x3C,
    0x0148, 0x28,
    0x0149, 0x3C,
    0x014A, 0x96,
    0x014B, 0xC8,
    0x0150, 0x14,
    0x0151, 0x30,
    0x0152, 0x54,
    0x0153, 0x70,
    0x0154, 0x14,
    0x0155, 0x30,
    0x0156, 0x54,
    0x0157, 0x70,
    0x0158, 0x14,
    0x0159, 0x30,
    0x015A, 0x54,
    0x015B, 0x70,
    0x015C, 0x30,
    0x015D, 0x00,
    0x01D8, 0x20,
    0x01D9, 0x08,
    0x01DA, 0x20,
    0x01DB, 0x08,
    0x01DC, 0x20,
    0x01DD, 0x08,
    0x01DE, 0x50,
    0x01E0, 0x50,
    0x01E2, 0x50,
    0x01E4, 0x10,
    0x01E5, 0x10,
    0x01E6, 0x02,
    0x01E7, 0x10,
    0x01E8, 0x10,
    0x01E9, 0x10,
    0x01EC, 0x28,
    0x0220, 0xF0,
    0x0221, 0xA0,
    0x0222, 0x00,
    0x0223, 0x80,
    0x0224, 0x80,
    0x0225, 0x00,
    0x0226, 0x80,
    0x0227, 0x80,
    0x0228, 0x00,
    0x0229, 0x80,
    0x022A, 0x80,
    0x022B, 0x00,
    0x022C, 0x80,
    0x022D, 0x12,
    0x022E, 0x10,
    0x022F, 0x12,
    0x0230, 0x10,
    0x0231, 0x12,
    0x0232, 0x10,
    0x0233, 0x12,
    0x0234, 0x10,
    0x0235, 0x80,
    0x0236, 0x02,
    0x0237, 0x80,
    0x0238, 0x02,
    0x0239, 0x80,
    0x023A, 0x02,
    0x023B, 0x80,
    0x023C, 0x02,
    0x023D, 0x00,
    0x023E, 0x02,
    0x023F, 0x00,
    0x0240, 0x02,
    0x0241, 0x00,
    0x0242, 0x02,
    0x0243, 0x00,
    0x0244, 0x02,
    0x0251, 0x10,
    0x0280, 0x00,
    0x0281, 0x41,
    0x0282, 0x00,
    0x0283, 0x6D,
    0x0284, 0x00,
    0x0285, 0xBC,
    0x0286, 0x01,
    0x0287, 0x45,
    0x0288, 0x01,
    0x0289, 0x7B,
    0x028A, 0x01,
    0x028B, 0xAC,
    0x028C, 0x01,
    0x028D, 0xD2,
    0x028E, 0x01,
    0x028F, 0xF6,
    0x0290, 0x02,
    0x0291, 0x16,
    0x0292, 0x02,
    0x0293, 0x35,
    0x0294, 0x02,
    0x0295, 0x6E,
    0x0296, 0x02,
    0x0297, 0xA2,
    0x0298, 0x02,
    0x0299, 0xFF,
    0x029A, 0x03,
    0x029B, 0x51,
    0x029C, 0x03,
    0x029D, 0x9B,
    0x029E, 0x00,
    0x029F, 0x85,
    0x02A0, 0x04,
    0x02C0, 0x80,
    0x02C1, 0x01,
    0x02C2, 0x71,
    0x02C3, 0x04,
    0x02C4, 0x0F,
    0x02C5, 0x04,
    0x02C6, 0x3D,
    0x02C7, 0x04,
    0x02C8, 0x94,
    0x02C9, 0x01,
    0x02CA, 0x57,
    0x02CB, 0x04,
    0x02CC, 0x0F,
    0x02CD, 0x04,
    0x02CE, 0x8F,
    0x02CF, 0x04,
    0x02D0, 0x9E,
    0x02D1, 0x01,
    0x02E0, 0x06,
    0x02E1, 0xC0,
    0x02E2, 0xE0,
    0x02F0, 0x48,
    0x02F1, 0x01,
    0x02F2, 0x32,
    0x02F3, 0x04,
    0x02F4, 0x16,
    0x02F5, 0x04,
    0x02F6, 0x52,
    0x02F7, 0x04,
    0x02F8, 0xAA,
    0x02F9, 0x01,
    0x02FA, 0x58,
    0x02FB, 0x04,
    0x02FC, 0x56,
    0x02FD, 0x04,
    0x02FE, 0xDD,
    0x02FF, 0x04,
    0x0300, 0x33,
    0x0301, 0x02,
    0x0324, 0x00,
    0x0325, 0x01,
    0x0333, 0x86,
    0x0334, 0x00,
    0x0335, 0x86,
    0x0340, 0x40,
    0x0341, 0x44,
    0x0342, 0x4A,
    0x0343, 0x2B,
    0x0344, 0x94,
    0x0345, 0x3F,
    0x0346, 0x8E,
    0x0347, 0x51,
    0x0348, 0x75,
    0x0349, 0x5C,
    0x034A, 0x6A,
    0x034B, 0x68,
    0x034C, 0x5E,
    0x0350, 0x7C,
    0x0351, 0x78,
    0x0352, 0x08,
    0x0353, 0x04,
    0x0354, 0x80,
    0x0355, 0x9A,
    0x0356, 0xCC,
    0x0357, 0xFF,
    0x0358, 0xFF,
    0x035A, 0xFF,
    0x035B, 0x00,
    0x035C, 0x70,
    0x035D, 0x80,
    0x035F, 0xA0,
    0x0488, 0x30,
    0x0360, 0xDF,
    0x0361, 0x00,
    0x0362, 0xFF,
    0x0363, 0x03,
    0x0364, 0xFF,
    0x037B, 0x11,
    0x037C, 0x1E,
    0x0380, 0xFF,
    0x0383, 0x50,
    0x038A, 0x64,
    0x038B, 0x64,
    0x038E, 0x3C,
    0x0391, 0x2A,
    0x0393, 0x1E,
    0x0394, 0x64,
    0x0395, 0x23,
    0x0398, 0x03,
    0x0399, 0x45,
    0x039A, 0x06,
    0x039B, 0x8B,
    0x039C, 0x0D,
    0x039D, 0x16,
    0x039E, 0x0A,
    0x039F, 0x10,
    0x03A0, 0x10,
    0x03A1, 0xE5,
    0x03A2, 0x06,
    0x03A4, 0x18,
    0x03A5, 0x48,
    0x03A6, 0x2D,
    0x03A7, 0x78,
    0x03AC, 0x5A,
    0x03AD, 0x0F,
    0x03AE, 0x7F,
    0x03AF, 0x04,
    0x03B0, 0x35,
    0x03B1, 0x14,
    0x036F, 0x04,
    0x0370, 0x0A,
    0x0371, 0x04,
    0x0372, 0x00,
    0x0373, 0x40,
    0x0374, 0x20,
    0x0375, 0x04,
    0x0376, 0x00,
    0x0377, 0x08,
    0x0378, 0x08,
    0x0379, 0x04,
    0x037A, 0x08,
    0x0420, 0x00,
    0x0421, 0x00,
    0x0422, 0x00,
    0x0423, 0x84,
    0x0430, 0x10,
    0x0431, 0x60,
    0x0432, 0x10,
    0x0433, 0x20,
    0x0434, 0x00,
    0x0435, 0x30,
    0x0436, 0x00,
    0x0450, 0xFD,
    0x0451, 0xD8,
    0x0452, 0xA0,
    0x0453, 0x50,
    0x0454, 0x00,
    0x0459, 0x04,
    0x045A, 0x00,
    0x045B, 0x30,
    0x045C, 0x01,
    0x045D, 0x70,
    0x0460, 0x00,
    0x0461, 0x00,
    0x0462, 0x00,
    0x0465, 0x86,
    0x0466, 0x84,
    0x0478, 0x00,
    0x0480, 0x60,
    0x0481, 0x06,
    0x0482, 0x0C,
    0x04B0, 0x4C,
    0x04B1, 0x86,
    0x04B2, 0x00,
    0x04B3, 0x18,
    0x04B4, 0x00,
    0x04B5, 0x00,
    0x04B6, 0x30,
    0x04B7, 0x00,
    0x04B8, 0x00,
    0x04B9, 0x10,
    0x04BA, 0x00,
    0x04BB, 0x00,
    0x04BD, 0x00,
    0x04D0, 0x56,
    0x04D6, 0x30,
    0x04DD, 0x10,
    0x04D9, 0x16,
    0x04D3, 0x18,
    0x0540, 0x01,
    0x0541, 0x02,
    0x0542, 0x01,
    0x0543, 0x36,
    0x0580, 0x50,
    0x0581, 0x30,
    0x0582, 0x2D,
    0x0583, 0x16,
    0x0584, 0x1E,
    0x0585, 0x0F,
    0x0586, 0x08,
    0x0587, 0x10,
    0x0590, 0x10,
    0x0591, 0x10,
    0x0592, 0x05,
    0x0593, 0x05,
    0x0594, 0x04,
    0x0595, 0x06,
    0x05B0, 0x04,
    0x05B1, 0x00,
    0x05E4, 0x08,
    0x05E5, 0x00,
    0x05E6, 0x07,
    0x05E7, 0x05,
    0x05E8, 0x0A,
    0x05E9, 0x00,
    0x05EA, 0xD7,
    0x05EB, 0x03,
    0x0666, 0x02,
    0x0667, 0xE0,
    0x067F, 0x19,
    0x067C, 0x00,
    0x067D, 0x00,
    0x0682, 0x00,
    0x0683, 0x00,
    0x0688, 0x00,
    0x0689, 0x00,
    0x068E, 0x00,
    0x068F, 0x00,
    0x0695, 0x00,
    0x0694, 0x00,
    0x0697, 0x19,
    0x069B, 0x00,
    0x069C, 0x20,
    0x0720, 0x00,
    0x0725, 0x6A,
    0x0726, 0x03,
    0x072B, 0x64,
    0x072C, 0x64,
    0x072D, 0x20,
    0x072E, 0x82,
    0x072F, 0x08,
    0x0800, 0x16,
    0x0801, 0x4F,
    0x0802, 0x00,
    0x0803, 0x68,
    0x0804, 0x01,
    0x0805, 0x28,
    0x0806, 0x10,
    0x0808, 0x1D,
    0x0809, 0x18,
    0x080A, 0x10,
    0x080B, 0x07,
    0x080D, 0x0F,
    0x080E, 0x0F,
    0x0810, 0x00,
    0x0811, 0x08,
    0x0812, 0x20,
    0x0857, 0x0A,
    0x0858, 0x04,
    0x0859, 0x01,
    0x085A, 0x04,
    0x085B, 0x08,
    0x085C, 0x03,
    0x085D, 0x7F,
    0x085E, 0x04,
    0x085F, 0x00,
    0x0860, 0x03,
    0x0861, 0x7F,
    0x0862, 0x04,
    0x0863, 0x00,
    0x0864, 0x02,
    0x0865, 0x7F,
    0x0866, 0x01,
    0x0867, 0x00,
    0x0868, 0x40,
    0x0869, 0x01,
    0x086A, 0x00,
    0x086B, 0x40,
    0x086C, 0x01,
    0x086D, 0x00,
    0x086E, 0x40,
    0x0870, 0x00,
    0x0871, 0x14,
    0x0872, 0x01,
    0x0873, 0x20,
    0x0874, 0x00,
    0x0875, 0x14,
    0x0876, 0x00,
    0x0877, 0xEC,
    0x0815, 0x00,
    0x0816, 0x4C,
    0x0817, 0x00,
    0x0818, 0x7B,
    0x0819, 0x00,
    0x081A, 0xCA,
    0x081B, 0x01,
    0x081C, 0x3E,
    0x081D, 0x01,
    0x081E, 0x77,
    0x081F, 0x01,
    0x0820, 0xAA,
    0x0821, 0x01,
    0x0822, 0xCE,
    0x0823, 0x01,
    0x0824, 0xEE,
    0x0825, 0x02,
    0x0826, 0x16,
    0x0827, 0x02,
    0x0828, 0x33,
    0x0829, 0x02,
    0x082A, 0x65,
    0x082B, 0x02,
    0x082C, 0x91,
    0x082D, 0x02,
    0x082E, 0xDC,
    0x082F, 0x03,
    0x0830, 0x28,
    0x0831, 0x03,
    0x0832, 0x74,
    0x0833, 0x03,
    0x0834, 0xFF,
    0x0882, 0x00,
    0x0883, 0x3E,
    0x0884, 0x00,
    0x0885, 0x70,
    0x0886, 0x00,
    0x0887, 0xB8,
    0x0888, 0x01,
    0x0889, 0x28,
    0x088A, 0x01,
    0x088B, 0x5B,
    0x088C, 0x01,
    0x088D, 0x8A,
    0x088E, 0x01,
    0x088F, 0xB1,
    0x0890, 0x01,
    0x0891, 0xD9,
    0x0892, 0x01,
    0x0893, 0xEE,
    0x0894, 0x02,
    0x0895, 0x0F,
    0x0896, 0x02,
    0x0897, 0x4C,
    0x0898, 0x02,
    0x0899, 0x74,
    0x089A, 0x02,
    0x089B, 0xC3,
    0x089C, 0x03,
    0x089D, 0x0F,
    0x089E, 0x03,
    0x089F, 0x57,
    0x08A0, 0x03,
    0x08A1, 0xFF,
    0x0011, 0x0B,
    0x0025, 0x00,
    0x0026, 0x0F,
    0x002B, 0x81,
    0x0540, 0x01,
    0x0541, 0x06,
    0x0542, 0x01,
    0x0543, 0x3B,
    0x085A, 0x04,
    0x085B, 0x18,
    0x0100, 0x01,
    0x0101, 0x01,
    0x0000, 0x01,
    0x002C, 0x00,
    0x0005, 0x01,
};

static u16 HM1375_SXGA_CFG[] = {
    0x0022, 0x00,
    0x000C, 0x04,
    0x0006, 0x00,
    0x000A, 0x00,
    0x000F, 0x10,
    0x0011, 0x42,
    0x0012, 0x01,
    0x0013, 0x02,
    0x0015, 0x01,
    0x0016, 0x00,
    0x0018, 0x00,
    0x001D, 0x40,
    0x0020, 0x30,
    0x0023, 0x43,
    0x0024, 0x20,
    0x0025, 0x01,
    0x0026, 0x51,
    0x0027, 0x90,   ///< CbYCrY, ITU-BT601 Disable
    0x0028, 0x01,
    0x0029, 0x80,   ///< CCIR656 Enable
    0x0030, 0x00,
    0x0034, 0x0E,
    0x0035, 0x01,
    0x0036, 0x00,
    0x0038, 0x02,
    0x0039, 0x01,
    0x003A, 0x01,
    0x003B, 0xFF,
    0x003C, 0xFF,
    0x003D, 0x40,
    0x003F, 0x14,
    0x0040, 0x10,
    0x0044, 0x07,
    0x0045, 0x25,
    0x0048, 0x7F,
    0x004E, 0xFF,
    0x0070, 0x00,
    0x0071, 0x4F,
    0x0072, 0x00,
    0x0073, 0x30,
    0x0074, 0x13,
    0x0075, 0x40,
    0x0076, 0x24,
    0x0078, 0x0F,
    0x007A, 0x06,
    0x007B, 0xc2,
    0x007C, 0x10,
    0x0080, 0xC9,
    0x0081, 0x00,
    0x0082, 0x28,
    0x0083, 0xB0,
    0x0084, 0x60,
    0x0086, 0x3E,
    0x0087, 0x70,
    0x0088, 0x11,
    0x0089, 0x3C,
    0x008A, 0x87,
    0x008D, 0x64,
    0x0090, 0x07,
    0x0091, 0x09,
    0x0092, 0x0C,
    0x0093, 0x0C,
    0x0094, 0x0C,
    0x0095, 0x0C,
    0x0096, 0x01,
    0x0097, 0x00,
    0x0098, 0x04,
    0x0099, 0x08,
    0x009A, 0x0C,
    0x0120, 0x37,
    0x0121, 0x81,
    0x0122, 0xEB,
    0x0123, 0x29,
    0x0124, 0x50,
    0x0125, 0xDE,
    0x0126, 0xB1,
    0x013D, 0x0F,
    0x013E, 0x0F,
    0x013F, 0x0F,
    0x0140, 0x14,
    0x0141, 0x0A,
    0x0142, 0x14,
    0x0143, 0x0A,
    0x0144, 0x08,
    0x0145, 0x04,
    0x0146, 0x28,
    0x0147, 0x3C,
    0x0148, 0x28,
    0x0149, 0x3C,
    0x014A, 0x96,
    0x014B, 0xC8,
    0x0150, 0x14,
    0x0151, 0x30,
    0x0152, 0x54,
    0x0153, 0x70,
    0x0154, 0x14,
    0x0155, 0x30,
    0x0156, 0x54,
    0x0157, 0x70,
    0x0158, 0x14,
    0x0159, 0x30,
    0x015A, 0x54,
    0x015B, 0x70,
    0x015C, 0x30,
    0x015D, 0x00,
    0x01D8, 0x20,
    0x01D9, 0x08,
    0x01DA, 0x20,
    0x01DB, 0x08,
    0x01DC, 0x20,
    0x01DD, 0x08,
    0x01DE, 0x50,
    0x01E0, 0x50,
    0x01E2, 0x50,
    0x01E4, 0x10,
    0x01E5, 0x10,
    0x01E6, 0x02,
    0x01E7, 0x10,
    0x01E8, 0x10,
    0x01E9, 0x10,
    0x01EC, 0x28,
    0x0220, 0xF0,
    0x0221, 0xA0,
    0x0222, 0x00,
    0x0223, 0x80,
    0x0224, 0x80,
    0x0225, 0x00,
    0x0226, 0x80,
    0x0227, 0x80,
    0x0228, 0x00,
    0x0229, 0x80,
    0x022A, 0x80,
    0x022B, 0x00,
    0x022C, 0x80,
    0x022D, 0x12,
    0x022E, 0x10,
    0x022F, 0x12,
    0x0230, 0x10,
    0x0231, 0x12,
    0x0232, 0x10,
    0x0233, 0x12,
    0x0234, 0x10,
    0x0235, 0x80,
    0x0236, 0x02,
    0x0237, 0x80,
    0x0238, 0x02,
    0x0239, 0x80,
    0x023A, 0x02,
    0x023B, 0x80,
    0x023C, 0x02,
    0x023D, 0x00,
    0x023E, 0x02,
    0x023F, 0x00,
    0x0240, 0x02,
    0x0241, 0x00,
    0x0242, 0x02,
    0x0243, 0x00,
    0x0244, 0x02,
    0x0251, 0x10,
    0x0280, 0x00,
    0x0281, 0x41,
    0x0282, 0x00,
    0x0283, 0x6D,
    0x0284, 0x00,
    0x0285, 0xBC,
    0x0286, 0x01,
    0x0287, 0x45,
    0x0288, 0x01,
    0x0289, 0x7B,
    0x028A, 0x01,
    0x028B, 0xAC,
    0x028C, 0x01,
    0x028D, 0xD2,
    0x028E, 0x01,
    0x028F, 0xF6,
    0x0290, 0x02,
    0x0291, 0x16,
    0x0292, 0x02,
    0x0293, 0x35,
    0x0294, 0x02,
    0x0295, 0x6E,
    0x0296, 0x02,
    0x0297, 0xA2,
    0x0298, 0x02,
    0x0299, 0xFF,
    0x029A, 0x03,
    0x029B, 0x51,
    0x029C, 0x03,
    0x029D, 0x9B,
    0x029E, 0x00,
    0x029F, 0x85,
    0x02A0, 0x04,
    0x02C0, 0x80,
    0x02C1, 0x01,
    0x02C2, 0x71,
    0x02C3, 0x04,
    0x02C4, 0x0F,
    0x02C5, 0x04,
    0x02C6, 0x3D,
    0x02C7, 0x04,
    0x02C8, 0x94,
    0x02C9, 0x01,
    0x02CA, 0x57,
    0x02CB, 0x04,
    0x02CC, 0x0F,
    0x02CD, 0x04,
    0x02CE, 0x8F,
    0x02CF, 0x04,
    0x02D0, 0x9E,
    0x02D1, 0x01,
    0x02E0, 0x06,
    0x02E1, 0xC0,
    0x02E2, 0xE0,
    0x02F0, 0x48,
    0x02F1, 0x01,
    0x02F2, 0x32,
    0x02F3, 0x04,
    0x02F4, 0x16,
    0x02F5, 0x04,
    0x02F6, 0x52,
    0x02F7, 0x04,
    0x02F8, 0xAA,
    0x02F9, 0x01,
    0x02FA, 0x58,
    0x02FB, 0x04,
    0x02FC, 0x56,
    0x02FD, 0x04,
    0x02FE, 0xDD,
    0x02FF, 0x04,
    0x0300, 0x33,
    0x0301, 0x02,
    0x0324, 0x00,
    0x0325, 0x01,
    0x0333, 0x86,
    0x0334, 0x00,
    0x0335, 0x86,
    0x0340, 0x40,
    0x0341, 0x44,
    0x0342, 0x4A,
    0x0343, 0x2B,
    0x0344, 0x94,
    0x0345, 0x3F,
    0x0346, 0x8E,
    0x0347, 0x51,
    0x0348, 0x75,
    0x0349, 0x5C,
    0x034A, 0x6A,
    0x034B, 0x68,
    0x034C, 0x5E,
    0x0350, 0x7C,
    0x0351, 0x78,
    0x0352, 0x08,
    0x0353, 0x04,
    0x0354, 0x80,
    0x0355, 0x9A,
    0x0356, 0xCC,
    0x0357, 0xFF,
    0x0358, 0xFF,
    0x035A, 0xFF,
    0x035B, 0x00,
    0x035C, 0x70,
    0x035D, 0x80,
    0x035F, 0xA0,
    0x0488, 0x30,
    0x0360, 0xDF,
    0x0361, 0x00,
    0x0362, 0xFF,
    0x0363, 0x03,
    0x0364, 0xFF,
    0x037B, 0x11,
    0x037C, 0x1E,
    0x0380, 0xFF,
    0x0383, 0x50,
    0x038A, 0x64,
    0x038B, 0x64,
    0x038E, 0x3C,
    0x0391, 0x2A,
    0x0393, 0x1E,
    0x0394, 0x64,
    0x0395, 0x23,
    0x0398, 0x03,
    0x0399, 0x45,
    0x039A, 0x06,
    0x039B, 0x8B,
    0x039C, 0x0D,
    0x039D, 0x16,
    0x039E, 0x0A,
    0x039F, 0x10,
    0x03A0, 0x10,
    0x03A1, 0xE5,
    0x03A2, 0x06,
    0x03A4, 0x18,
    0x03A5, 0x48,
    0x03A6, 0x2D,
    0x03A7, 0x78,
    0x03AC, 0x5A,
    0x03AD, 0x0F,
    0x03AE, 0x7F,
    0x03AF, 0x04,
    0x03B0, 0x35,
    0x03B1, 0x14,
    0x036F, 0x04,
    0x0370, 0x0A,
    0x0371, 0x04,
    0x0372, 0x00,
    0x0373, 0x40,
    0x0374, 0x20,
    0x0375, 0x04,
    0x0376, 0x00,
    0x0377, 0x08,
    0x0378, 0x08,
    0x0379, 0x04,
    0x037A, 0x08,
    0x0380, 0xFF,
    0x0383, 0x50,
    0x038A, 0x64,
    0x038B, 0x64,
    0x038E, 0x3C,
    0x0391, 0x2A,
    0x0393, 0x1E,
    0x0394, 0x64,
    0x0395, 0x23,
    0x0398, 0x03,
    0x0399, 0x45,
    0x039A, 0x06,
    0x039B, 0x8B,
    0x039C, 0x0D,
    0x039D, 0x16,
    0x039E, 0x0A,
    0x039F, 0x10,
    0x03A0, 0x10,
    0x03A1, 0xE5,
    0x03A2, 0x06,
    0x03A4, 0x18,
    0x03A5, 0x48,
    0x03A6, 0x2D,
    0x03A7, 0x78,
    0x03AC, 0x5A,
    0x03AD, 0x0F,
    0x03AE, 0x7F,
    0x03AF, 0x04,
    0x03B0, 0x35,
    0x03B1, 0x14,
    0x036F, 0x04,
    0x0370, 0x0A,
    0x0371, 0x04,
    0x0372, 0x00,
    0x0373, 0x40,
    0x0374, 0x20,
    0x0375, 0x04,
    0x0376, 0x00,
    0x0377, 0x08,
    0x0378, 0x08,
    0x0379, 0x04,
    0x037A, 0x08,
    0x0430, 0x10,
    0x0431, 0x60,
    0x0432, 0x10,
    0x0433, 0x20,
    0x0434, 0x00,
    0x0435, 0x30,
    0x0436, 0x00,
    0x0450, 0xFD,
    0x0451, 0xD8,
    0x0452, 0xA0,
    0x0453, 0x50,
    0x0454, 0x00,
    0x0459, 0x04,
    0x045A, 0x00,
    0x045B, 0x30,
    0x045C, 0x01,
    0x045D, 0x70,
    0x0460, 0x00,
    0x0461, 0x00,
    0x0462, 0x00,
    0x0465, 0x86,
    0x0466, 0x84,
    0x0478, 0x00,
    0x0480, 0x60,
    0x0481, 0x06,
    0x0482, 0x0C,
    0x04B0, 0x4C,
    0x04B1, 0x86,
    0x04B2, 0x00,
    0x04B3, 0x18,
    0x04B4, 0x00,
    0x04B5, 0x00,
    0x04B6, 0x30,
    0x04B7, 0x00,
    0x04B8, 0x00,
    0x04B9, 0x10,
    0x04BA, 0x00,
    0x04BB, 0x00,
    0x04BD, 0x00,
    0x04D0, 0x56,
    0x04D6, 0x30,
    0x04DD, 0x10,
    0x04D9, 0x16,
    0x04D3, 0x18,
    0x0540, 0x00,
    0x0541, 0xc3,
    0x0542, 0x00,
    0x0543, 0xea,
    0x0580, 0x50,
    0x0581, 0x30,
    0x0582, 0x2D,
    0x0583, 0x16,
    0x0584, 0x1E,
    0x0585, 0x0F,
    0x0586, 0x08,
    0x0587, 0x10,
    0x0590, 0x10,
    0x0591, 0x10,
    0x0592, 0x05,
    0x0593, 0x05,
    0x0594, 0x04,
    0x0595, 0x06,
    0x05B0, 0x04,
    0x05B1, 0x00,
    0x05E4, 0x08,
    0x05E5, 0x00,
    0x05E6, 0x07,
    0x05E7, 0x05,
    0x05E8, 0x0A,
    0x05E9, 0x00,
    0x05EA, 0x0F,
    0x05EB, 0x04,
    0x0666, 0x02,
    0x0667, 0xE0,
    0x067F, 0x19,
    0x067C, 0x00,
    0x067D, 0x00,
    0x0682, 0x00,
    0x0683, 0x00,
    0x0688, 0x00,
    0x0689, 0x00,
    0x068E, 0x00,
    0x068F, 0x00,
    0x0695, 0x00,
    0x0694, 0x00,
    0x0697, 0x19,
    0x069B, 0x00,
    0x069C, 0x20,
    0x0720, 0x00,
    0x0725, 0x6A,
    0x0726, 0x03,
    0x072B, 0x64,
    0x072C, 0x64,
    0x072D, 0x20,
    0x072E, 0x82,
    0x072F, 0x08,
    0x0800, 0x16,
    0x0801, 0x4F,
    0x0802, 0x00,
    0x0803, 0x68,
    0x0804, 0x01,
    0x0805, 0x28,
    0x0806, 0x10,
    0x0808, 0x1D,
    0x0809, 0x18,
    0x080A, 0x10,
    0x080B, 0x07,
    0x080D, 0x0F,
    0x080E, 0x0F,
    0x0810, 0x00,
    0x0811, 0x08,
    0x0812, 0x20,
    0x0857, 0x0A,
    0x0858, 0x04,
    0x0859, 0x01,
    0x085A, 0x03,
    0x085B, 0x0c,
    0x085C, 0x03,
    0x085D, 0x7F,
    0x085E, 0x04,
    0x085F, 0x00,
    0x0860, 0x03,
    0x0861, 0x7F,
    0x0862, 0x04,
    0x0863, 0x00,
    0x0864, 0x02,
    0x0865, 0x7F,
    0x0866, 0x01,
    0x0867, 0x00,
    0x0868, 0x40,
    0x0869, 0x01,
    0x086A, 0x00,
    0x086B, 0x40,
    0x086C, 0x01,
    0x086D, 0x00,
    0x086E, 0x40,
    0x0870, 0x00,
    0x0871, 0x14,
    0x0872, 0x01,
    0x0873, 0x20,
    0x0874, 0x00,
    0x0875, 0x14,
    0x0876, 0x00,
    0x0877, 0xEC,
    0x0815, 0x00,
    0x0816, 0x4C,
    0x0817, 0x00,
    0x0818, 0x7B,
    0x0819, 0x00,
    0x081A, 0xCA,
    0x081B, 0x01,
    0x081C, 0x3E,
    0x081D, 0x01,
    0x081E, 0x77,
    0x081F, 0x01,
    0x0820, 0xAA,
    0x0821, 0x01,
    0x0822, 0xCE,
    0x0823, 0x01,
    0x0824, 0xEE,
    0x0825, 0x02,
    0x0826, 0x16,
    0x0827, 0x02,
    0x0828, 0x33,
    0x0829, 0x02,
    0x082A, 0x65,
    0x082B, 0x02,
    0x082C, 0x91,
    0x082D, 0x02,
    0x082E, 0xDC,
    0x082F, 0x03,
    0x0830, 0x28,
    0x0831, 0x03,
    0x0832, 0x74,
    0x0833, 0x03,
    0x0834, 0xFF,
    0x0882, 0x00,
    0x0883, 0x3E,
    0x0884, 0x00,
    0x0885, 0x70,
    0x0886, 0x00,
    0x0887, 0xB8,
    0x0888, 0x01,
    0x0889, 0x28,
    0x088A, 0x01,
    0x088B, 0x5B,
    0x088C, 0x01,
    0x088D, 0x8A,
    0x088E, 0x01,
    0x088F, 0xB1,
    0x0890, 0x01,
    0x0891, 0xD9,
    0x0892, 0x01,
    0x0893, 0xEE,
    0x0894, 0x02,
    0x0895, 0x0F,
    0x0896, 0x02,
    0x0897, 0x4C,
    0x0898, 0x02,
    0x0899, 0x74,
    0x089A, 0x02,
    0x089B, 0xC3,
    0x089C, 0x03,
    0x089D, 0x0F,
    0x089E, 0x03,
    0x089F, 0x57,
    0x08A0, 0x03,
    0x08A1, 0xFF,
    0x0100, 0x01,
    0x0101, 0x01,
    0x0000, 0x01,
    0x002C, 0x00,
    0x0005, 0x01,
};

static int hm1375_i2c_probe(struct i2c_client *client, const struct i2c_device_id *did)
{
    hm1375_i2c_client = client;
    return 0;
}

static int hm1375_i2c_remove(struct i2c_client *client)
{
    return 0;
}

static const struct i2c_device_id hm1375_i2c_id[] = {
    { "hm1375_i2c", 0 },
    { }
};

static struct i2c_driver hm1375_i2c_driver = {
    .driver = {
        .name  = "HM1375_I2C",
        .owner = THIS_MODULE,
    },
    .probe    = hm1375_i2c_probe,
    .remove   = hm1375_i2c_remove,
    .id_table = hm1375_i2c_id
};

static int hm1375_i2c_register(void)
{
    int ret;
    struct i2c_board_info info;
    struct i2c_adapter    *adapter;
    struct i2c_client     *client;

    /* add i2c driver */
    ret = i2c_add_driver(&hm1375_i2c_driver);
    if(ret < 0) {
        printk("HM1375 can't add i2c driver!\n");
        return ret;
    }

    memset(&info, 0, sizeof(struct i2c_board_info));
    info.addr = iaddr[0]>>1;
    strlcpy(info.type, "hm1375_i2c", I2C_NAME_SIZE);

    adapter = i2c_get_adapter(ibus);   ///< I2C BUS#
    if (!adapter) {
        printk("HM1375 can't get i2c adapter\n");
        goto err_driver;
    }

    /* add i2c device */
    client = i2c_new_device(adapter, &info);
    i2c_put_adapter(adapter);
    if(!client) {
        printk("HM1375 can't add i2c device!\n");
        goto err_driver;
    }

    return 0;

err_driver:
   i2c_del_driver(&hm1375_i2c_driver);
   return -ENODEV;
}

static void hm1375_i2c_unregister(void)
{
    i2c_unregister_device(hm1375_i2c_client);
    i2c_del_driver(&hm1375_i2c_driver);
    hm1375_i2c_client = NULL;
}

static int hm1375_proc_vmode_show(struct seq_file *sfile, void *v)
{
    int i, vmode;
    struct hm1375_dev_t *pdev = (struct hm1375_dev_t *)sfile->private;
    char *vmode_str[] = {"VGA_640x480", "HD720_1280x720", "WXGA_1280x960", "SXGA_1280x1024"};

    down(&pdev->lock);

    seq_printf(sfile, "\n[HM1375#%d]\n", pdev->index);
    for(i=0; i<HM1375_VMODE_MAX; i++) {
        seq_printf(sfile, "%02d: %s\n", i, vmode_str[i]);
    }
    seq_printf(sfile, "----------------------------------\n");

    vmode = hm1375_video_get_mode(pdev->index);
    seq_printf(sfile, "Current==> %s %s\n\n",
               ((vmode >= 0 && vmode < HM1375_VMODE_MAX) ? vmode_str[vmode] : "Unknown"),
               ((is_50hz == 0) ? "60Hz" : "50Hz"));

    up(&pdev->lock);

    return 0;
}

static int hm1375_proc_vmode_open(struct inode *inode, struct file *file)
{
    return single_open(file, hm1375_proc_vmode_show, PDE(inode)->data);
}

static struct file_operations hm1375_proc_vmode_ops = {
    .owner  = THIS_MODULE,
    .open   = hm1375_proc_vmode_open,
    .read   = seq_read,
    .llseek = seq_lseek,
    .release= single_release,
};

static void hm1375_proc_remove(int id)
{
    if(id >= HM1375_DEV_MAX)
        return;

    if(hm1375_proc_root[id]) {
        if(hm1375_proc_vmode[id]) {
            remove_proc_entry(hm1375_proc_vmode[id]->name, hm1375_proc_root[id]);
            hm1375_proc_vmode[id] = NULL;
        }

        remove_proc_entry(hm1375_proc_root[id]->name, NULL);
        hm1375_proc_root[id] = NULL;
    }
}

static int hm1375_proc_init(int id)
{
    int ret = 0;

    if(id >= HM1375_DEV_MAX)
        return -1;

    /* root */
    hm1375_proc_root[id] = create_proc_entry(hm1375_dev[id].name, S_IFDIR|S_IRUGO|S_IXUGO, NULL);
    if(!hm1375_proc_root[id]) {
        printk("create proc node '%s' failed!\n", hm1375_dev[id].name);
        ret = -EINVAL;
        goto end;
    }
#if (LINUX_VERSION_CODE <= KERNEL_VERSION(2,6,30))
    hm1375_proc_root[id]->owner = THIS_MODULE;
#endif

    /* vmode */
    hm1375_proc_vmode[id] = create_proc_entry("vmode", S_IRUGO|S_IXUGO, hm1375_proc_root[id]);
    if(!hm1375_proc_vmode[id]) {
        printk("create proc node '%s/vmode' failed!\n", hm1375_dev[id].name);
        ret = -EINVAL;
        goto err;
    }
    hm1375_proc_vmode[id]->proc_fops = &hm1375_proc_vmode_ops;
    hm1375_proc_vmode[id]->data      = (void *)&hm1375_dev[id];
#if (LINUX_VERSION_CODE <= KERNEL_VERSION(2,6,30))
    hm1375_proc_vmode[id]->owner     = THIS_MODULE;
#endif

end:
    return ret;

err:
    hm1375_proc_remove(id);
    return ret;
}

int hm1375_get_device_num(void)
{
    return dev_num;
}
EXPORT_SYMBOL(hm1375_get_device_num);

int hm1375_get_vch_id(int id)
{
    if(id >= dev_num)
        return 0;

    return ch_id[id];
}
EXPORT_SYMBOL(hm1375_get_vch_id);

int hm1375_i2c_write(u8 id, u16 reg, u8 data)
{
    u8  buf[3];
    struct i2c_msg msgs;
    struct i2c_adapter *adapter;

    if(id >= dev_num)
        return -1;

    if(!hm1375_i2c_client) {
        printk("HM1375 i2c_client not register!!\n");
        return -1;
    }

    adapter = to_i2c_adapter(hm1375_i2c_client->dev.parent);

    buf[0] = (reg>>8) & 0xff;   ///< Sub-Address is MSB first
    buf[1] = (reg & 0xff);
    buf[2] = data;

    msgs.addr  = iaddr[id]>>1;
    msgs.flags = 0;
    msgs.len   = 3;
    msgs.buf   = buf;

    if(i2c_transfer(adapter, &msgs, 1) != 1) {
        printk("HM1375#%d i2c write failed!!\n", id);
        return -1;
    }

    return 0;
}
EXPORT_SYMBOL(hm1375_i2c_write);

int hm1375_i2c_read(u8 id, u16 reg)
{
    u8 buf[2];
    u8 data = 0;
    struct i2c_msg msgs[2];
    struct i2c_adapter *adapter;

    if(id >= dev_num)
        return 0;

    if(!hm1375_i2c_client) {
        printk("HM1375 i2c_client not register!!\n");
        return 0;
    }

    adapter = to_i2c_adapter(hm1375_i2c_client->dev.parent);

    buf[0] = (reg>>8) & 0xff;   ///< Sub-Address is MSB first
    buf[1] = (reg & 0xff);

    msgs[0].addr  = iaddr[id]>>1;
    msgs[0].flags = 0; /* write */
    msgs[0].len   = 2;
    msgs[0].buf   = buf;

    msgs[1].addr  = (iaddr[id] + 1)>>1;
    msgs[1].flags = 1; /* read */
    msgs[1].len   = 1;
    msgs[1].buf   = (u8 *)&data;

    if(i2c_transfer(adapter, msgs, 2) != 2) {
        printk("HM1375#%d i2c read failed!!\n", id);
        return -1;
    }

    return data;
}
EXPORT_SYMBOL(hm1375_i2c_read);

int hm1375_video_get_mode(int id)
{
    if(id >= dev_num)
        return HM1375_VMODE_MAX;

    return hm1375_dev[id].vmode;
}
EXPORT_SYMBOL(hm1375_video_get_mode);

int hm1375_video_set_mode(int id, HM1375_VMODE_T v_mode)
{
    int i, ret = 0;
    u32 mclk;

    if((id >= dev_num) || (v_mode >= HM1375_VMODE_MAX))
        return -1;

    down(&hm1375_dev[id].lock);

    if(v_mode != hm1375_dev[id].vmode) {
        /* switch external clock out */
        switch(v_mode) {
            case HM1375_VMODE_VGA:
            case HM1375_VMODE_WXGA_960:
                mclk = HM1375_CLKIN_54MHZ;
                break;
            case HM1375_VMODE_SXGA:
            case HM1375_VMODE_HD720:
            default:
                mclk = HM1375_CLKIN_27MHZ;
                break;
        }

        /* switch platfrom external clock */
        if((init == 1) && (clk_used >= 0)) {
            if(clk_used && (clk_freq != mclk)) {
                if(clk_used & 0x1) {
                    ret = plat_extclk_set_freq(0, mclk);
                    if(ret < 0)
                        goto exit;
                }

                if(clk_used & 0x2) {
                    ret = plat_extclk_set_freq(1, mclk);
                    if(ret < 0)
                        goto exit;
                }

                clk_freq = mclk;
            }
        }

        /* switch video mode */
        switch(v_mode) {
            case HM1375_VMODE_VGA:
                for(i=0; i<(ARRAY_SIZE(HM1375_VGA_CFG)/2); i++) {
                    ret = hm1375_i2c_write(id, HM1375_VGA_CFG[i*2], (u8)HM1375_VGA_CFG[(i*2)+1]);
                    if(ret < 0)
                        goto exit;
                }

                if(is_50hz) {
                    ret = hm1375_i2c_write(id, 0x0120, 0x36);
                    if(ret < 0)
                        goto exit;
                }
                break;
            case HM1375_VMODE_WXGA_960:
                for(i=0; i<(ARRAY_SIZE(HM1375_WXGA_960_CFG)/2); i++) {
                    ret = hm1375_i2c_write(id, HM1375_WXGA_960_CFG[i*2], (u8)HM1375_WXGA_960_CFG[(i*2)+1]);
                    if(ret < 0)
                        goto exit;
                }

                if(is_50hz) {
                    ret = hm1375_i2c_write(id, 0x0011, 0xA9);
                    if(ret < 0)
                        goto exit;

                    ret = hm1375_i2c_write(id, 0x0120, 0x36);
                    if(ret < 0)
                        goto exit;

                    ret = hm1375_i2c_write(id, 0x0000, 0x01);
                    if(ret < 0)
                        goto exit;
                }
                break;
            case HM1375_VMODE_SXGA:
                for(i=0; i<(ARRAY_SIZE(HM1375_SXGA_CFG)/2); i++) {
                    ret = hm1375_i2c_write(id, HM1375_SXGA_CFG[i*2], (u8)HM1375_SXGA_CFG[(i*2)+1]);
                    if(ret < 0)
                        goto exit;
                }

                if(is_50hz) {
                    ret = hm1375_i2c_write(id, 0x0120, 0x36);
                    if(ret < 0)
                        goto exit;
                }
                break;
            case HM1375_VMODE_HD720:
            default:
                for(i=0; i<(ARRAY_SIZE(HM1375_HD720_CFG)/2); i++) {
                    ret = hm1375_i2c_write(id, HM1375_HD720_CFG[i*2], (u8)HM1375_HD720_CFG[(i*2)+1]);
                    if(ret < 0)
                        goto exit;
                }

                if(is_50hz) {
                    ret = hm1375_i2c_write(id, 0x0011, 0xb8);
                    if(ret < 0)
                        goto exit;

                    ret = hm1375_i2c_write(id, 0x0120, 0x36);
                    if(ret < 0)
                        goto exit;

                    ret = hm1375_i2c_write(id, 0x0000, 0x01);
                    if(ret < 0)
                        goto exit;
                }
                break;
        }
        hm1375_dev[id].vmode = v_mode;
    }

exit:
    up(&hm1375_dev[id].lock);

    return ret;
}
EXPORT_SYMBOL(hm1375_video_set_mode);

static void hm1375_hw_reset(void)
{
    if(!rstb_used || !init)
        return;

    /* Active Low */
    plat_gpio_set_value(rstb_used, 0);

    udelay(10);

    /* Active High and release reset */
    plat_gpio_set_value(rstb_used, 1);

    udelay(10);
}

static int hm1375_device_init(int id)
{
    int ret = 0;

    if(id >= HM1375_DEV_MAX)
        return -1;

    if(!init) {
        hm1375_dev[id].vmode = vmode[id];
        goto exit;
    }

    ret = hm1375_video_set_mode(id, vmode[id]);
    if(ret < 0)
        goto exit;

exit:
    printk("HM1375#%d Init...%s!\n", id, ((ret == 0) ? "OK" : "Fail"));

    return ret;
}

static int __init hm1375_init(void)
{
    int i, ret;

    /* platfrom check */
    plat_identifier_check();

    /* check device number */
    if(dev_num > HM1375_DEV_MAX) {
        printk("HM1375 dev_num=%d invalid!!(Max=%d)\n", dev_num, HM1375_DEV_MAX);
        return -1;
    }

    /* register i2c client */
    ret = hm1375_i2c_register();
    if(ret < 0)
        return -1;

    /* register gpio pin for device rstb pin */
    if(rstb_used && init) {
        ret = plat_register_gpio_pin(rstb_used, PLAT_GPIO_DIRECTION_OUT, 0);
        if(ret < 0)
            goto err;
    }

    /* setup platfrom external clock */
    if((init == 1) && (clk_used >= 0)) {
        if(clk_used) {
            ret = plat_extclk_set_src(clk_src);
            if(ret < 0)
                goto err;

            if(clk_used & 0x1) {
                ret = plat_extclk_set_freq(0, clk_freq);
                if(ret < 0)
                    goto err;
            }

            if(clk_used & 0x2) {
                ret = plat_extclk_set_freq(1, clk_freq);
                if(ret < 0)
                    goto err;
            }

            ret = plat_extclk_onoff(1);
            if(ret < 0)
                goto err;

        }
        else {
            /* use external oscillator. disable SoC external clock output */
            ret = plat_extclk_onoff(0);
            if(ret < 0)
                goto err;
        }
    }

    /* hardware reset for all device */
    hm1375_hw_reset();

    /* HM1375 init */
    for(i=0; i<dev_num; i++) {
        hm1375_dev[i].index = i;
        hm1375_dev[i].vmode = -1;   ///< init value

        sprintf(hm1375_dev[i].name, "hm1375.%d", i);

#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,37))
        sema_init(&hm1375_dev[i].lock, 1);
#else
        init_MUTEX(&hm1375_dev[i].lock);
#endif
        ret = hm1375_proc_init(i);
        if(ret < 0)
            goto err;

        ret = hm1375_device_init(i);
        if(ret < 0)
            goto err;
    }

    return 0;

err:
    hm1375_i2c_unregister();

    for(i=0; i<HM1375_DEV_MAX; i++) {
        if(hm1375_dev[i].miscdev.name)
            misc_deregister(&hm1375_dev[i].miscdev);

        hm1375_proc_remove(i);
    }

    if(rstb_used && init)
        plat_deregister_gpio_pin(rstb_used);

    return ret;
}

static void __exit hm1375_exit(void)
{
    int i;

    hm1375_i2c_unregister();

    for(i=0; i<HM1375_DEV_MAX; i++) {
        /* remove device node */
        if(hm1375_dev[i].miscdev.name)
            misc_deregister(&hm1375_dev[i].miscdev);

        /* remove proc node */
        hm1375_proc_remove(i);
    }

    /* release gpio pin */
    if(rstb_used && init)
        plat_deregister_gpio_pin(rstb_used);
}

module_init(hm1375_init);
module_exit(hm1375_exit);

MODULE_DESCRIPTION("Grain Media HM1375 CMOS Sensor Driver");
MODULE_AUTHOR("Grain Media Technology Corp.");
MODULE_LICENSE("GPL");
